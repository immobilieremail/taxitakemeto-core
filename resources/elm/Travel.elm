module Travel exposing (Travel, TravelFacet, swissNumberIsNotEqual, travelFacetDecoder, travelFromTravelFacet, updateAccordionState, updateListPI, view, viewList)

import Bootstrap.Accordion as Accordion
import Bootstrap.Grid as Grid
import Bootstrap.Grid.Col as Col
import Bootstrap.Grid.Row as Row
import Bootstrap.Text as Text
import Html exposing (Html, a, div, h5, text)
import Html.Attributes exposing (class, href)
import Json.Decode as D exposing (Decoder, field, map4, string)
import PI exposing (PI)
import SwissNumber exposing (SwissNumber)



-- TYPES


type alias TravelFacet =
    { swissNumber : SwissNumber
    , facetType : String
    , title : String
    , piList : Maybe SwissNumber
    }


type alias Travel =
    { swissNumber : SwissNumber
    , title : String
    , listPI : List PI
    , listContact : List SwissNumber
    , accordionState : Accordion.State
    }


swissNumberIsNotEqual : SwissNumber -> Travel -> Bool
swissNumberIsNotEqual swissNumber travel =
    travel.swissNumber /= swissNumber


updateListPI : SwissNumber -> List PI -> Travel -> Travel
updateListPI swissNumber list travel =
    if travel.swissNumber == swissNumber then
        { travel | listPI = travel.listPI ++ list }

    else
        travel


updateAccordionState : Accordion.State -> Travel -> Travel
updateAccordionState state travel =
    { swissNumber = travel.swissNumber
    , title = travel.title
    , listPI = travel.listPI
    , listContact = travel.listContact
    , accordionState = state
    }


travelFromTravelFacet : TravelFacet -> Travel
travelFromTravelFacet travelFacet =
    Travel
        travelFacet.swissNumber
        travelFacet.title
        []
        []
        Accordion.initialState



-- VIEWS


view : Travel -> Html msg
view travel =
    a
        [ href ("/elm/travel#" ++ travel.swissNumber) ]
        [ div
            [ class "travel-header" ]
            [ Grid.row
                [ Row.middleXs ]
                [ Grid.col
                    [ Col.xs12, Col.textAlign Text.alignXsLeft ]
                    [ h5
                        []
                        [ text travel.title ]
                    ]
                ]
            ]
        ]


viewList : List Travel -> Html msg
viewList listTravel =
    Grid.container [] (List.map view listTravel)



-- JSON Decoders


travelFacetDecoder : Decoder TravelFacet
travelFacetDecoder =
    D.map4 TravelFacet
        (field "url" string)
        (field "type" string)
        (field "data" (field "title" string))
        (D.maybe (field "data" (field "pis" string)))
